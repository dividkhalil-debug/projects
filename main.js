// ===============================
// بنك الأسئلة (جاهز للتوسيع)
// ===============================
const questionBank = {
  zakaria: [
    { q: "زكريا بن برخيا بن عدو تعنى الله يذكر الله يبارك فى الوقت المناسب", answers: ["صح","خطأ"], correct: 0 },
    { q: "نجد فى سفر زكريا نبوات واضحة عن المسيح مثل دخوله اورشليم وتسليمه بثلاثين من الفضة", answers: ["صح","خطأ"], correct: 0 },
    { q: "هكذا قال رب الجنود : ارجعوا الى قال رب الجنود ارجع اليكم قال رب الجنود . تكرار كلمة رب الجنود اشارة ل ..................", answers: ["الثالوث القدوس","حكام اسرائيل","الملائكة"], correct: 0 },
    { q: "كم مرة وردت كلمة رب الجنود فى سفر زكريا بالكامل؟", answers: ["42","48","52"], correct: 2 },
    { q: "شهر شباط هو الشهر الذى تفرخ فيه اشجار الاس وتفوح منه رائحته الطيبة؟", answers: ["صح","خطأ"], correct: 0 },
    { q: "كم عدد الرؤى فى سفر زكريا", answers: ["9","10","11"], correct: 0 },
    { q: "تكلم السيد المسح عن زكريا بن برخيا فى........", answers: ["مت 23 : 35","مت 10 : 35 ","مت 1 : 35"], correct: 0 },
    { q: "الرؤيا الاولى لزكريا كانت فالليل واذا برجل راكب على فرس احمر", answers: ["صح","خطأ"], correct: 0 },
    { q: "فى الرؤيا الاولى ظهر خيل حمر وشقر وشهب اشارة للحرب والاضطهاد والسلام", answers: ["صح","خطأ"], correct: 0 },
    { q: "الرؤيا الثانية لزكريا كانت لرجل وبيده حبل قياس لقيس اورشليم عرضا وطولا", answers: ["صح","خطأ"], correct: 0 },
    { q: "كان يهوشع الكاهن العظيم لابسا ثيابا قذرة وواقفا قدام الملاك فكلمة قذرة ترمز الى ", answers: ["الزهد","خطايا الشعب","العبودية"], correct: 1 },
    { q: "الرؤيا السابعة لزكريا بن برخيا هى الايفة الخارجة وهى وحدة مكاييل عند اليهود", answers: ["صح","خطأ"], correct: 0 },
    { q: "اللقلق فى سفر زكريا هو طائر نجس لانه يعيش على......", answers: ["الجيف والقذارة","الزهور","جميع ما سبق"], correct: 0 },
    { q: "الرؤيا الثامنة لزكريا هى لاربع مركبات تخرج من بين نهرين", answers: ["صح","خطأ"], correct: 1 },
    { q: "الخيل الدهم هى الخيول.......", answers: ["الحمراء","البيضاء","السوداء"], correct: 2 },
    { q: "فى الاصحاح السابع من سفر زكريا سال الله الشعب عن .......", answers: ["الصلاة","الصوم","الصدقة"], correct: 1 },
    { q: "تكلم سفر زكريا عن الارملة واليتيم والغريب وهذه الكلمات نسمعها فى .......", answers: ["القداس","التسبحة","الزيجة"], correct: 0 },
    { q: "وصف الله اورشليم بعد ان ترجع لله ويسكن الله فى وسطها بمدينة.......", answers: ["العدل","الخير","الحق"], correct: 2 },
    { q: "أقوى أسباط اسرائيل والمحرض على الشر هو سبط.......", answers: ["بنيامين","افرايم","رؤبين"], correct: 1 },
    { q: "يشير الارز والسرو والبلوط للجماعات اليهودية الرافضة ل .......", answers: ["للقانون","للظلم","للمسيح"], correct: 2 },
    { q: "من عادة الرعاة ان يستعملوا عصوين واحدة لطرد الوحوش التى تهاجم القطيع والاخرى لقيادة القطيع", answers: ["صح","خطأ"], correct: 0 },
    { q: "تكلم سفر زكريا عن الراعى الاحمق الذى تم ذكره فى سفر الرؤيا وهو.......", answers: ["ضد المسيح","الكتبة","الناموسيين"], correct: 0 },
    { q: "الدرج الطائر فى سفر زكريا هو.......", answers: ["الكتاب المخطوط","طائر شرس","اثاث"], correct: 0 },
    { q: " اتكتب سفر زكريا سنة ....... ق.م", answers: ["620","520","420"], correct: 1 },
    { q: "كان زكريا النبى معاصرا ل.......", answers: ["يهوشع بن يهوصادق","زربابل","حجى","جميع ما سبق"], correct: 3 }
  ],

  haggai: [
    { q: "ما هو عدد اصحاحات سفر حجى", answers: ["2","4","6"], correct: 0 },
    { q: "ما معنى اسم حجى", answers: ["فرح","تعزية","عيد"], correct: 2 },
    { q: "يعتبر حجى وزكريا وملاخى هم انبياء فترة .......", answers: ["قبل السبى","بعد السبى",], correct: 1 },
    { q: "سقطت مملكة بابل على يد كورش الفارسى سنة.......ق.م", answers: ["536","636","736"], correct: 0 },
    { q: "سقطت اورشليم تحت السبى البابلى على اربعة مراحل اخرها 586ق.م على يد الملك.......", answers: ["سرجون","نبويولاسار","نبوخذنصر"], correct: 2 },
    { q: "الشهر السادس هو شهر جنى الاثمار والمقصود به شهر", answers: ["ايار","ايلول","تشرين الاول"], correct: 1 },
    { q: "اتكتب سفر حجى فى ايام زربابل بن شالتئيل ايام داريوس الملك فى سنة حكمه .......", answers: ["الاولى","الثانية","الثالثة"], correct: 1 },
    { q: "كم مرة وردت كلمة رب الجنود فالاصحاح الاول", answers: ["1","3","5"], correct: 2 },
    { q: "كانت كلمة الرب على حجى النبى ليعلنها للشعب فى اول الشهر؟", answers: ["صح","خطأ"], correct: 0 },
    { q: "انشغل الشعب عن بناء هيكل الله لانهم كانوا منشغلين ب.......", answers: ["الصلاة","تقديس السبوت","بناء منازلهم"], correct: 2 },
    { q: "عندما سمع الشعب كلمة الرب على لسان حجى النبى", answers: ["خافوا","لم يسمعوا","لم يهتموا"], correct: 0 },
    { q: "اتولد حجى النبى فى ارض السبى وصعد الى يهوذا مع زربابل فى الرجوع الاول سنة 536 ق.م", answers: ["صح","خطأ"], correct: 0 },
    { q: "بدأ الشعب العمل فى بيت الرب فى اليوم الرابع والعشرين من الشهر", answers: ["الثالث","السادس","التاسع"], correct: 1 },
    { q: "جاءت النبوة الاولى لحجى النبى فى اليوم الاخير من الشهر السادس فى السنة الثانية من ملك داريوس فيها يوبخهم على ترك الهيكل خرابا", answers: ["صح","خطأ"], correct: 1 },
    { q: "انقسم سفر حجى النبى الى عدد من النبوات عددهم", answers: ["4","8","10"], correct: 0 },
    { q: "بدأ حجى النبى عمله قبل زكريا النبى ب.......", answers: ["يومين","شهرين","سنتين"], correct: 1 },
    { q: "كانت مدة نبوة حجى النبى.......شهور و ....... يوم", answers: ["9 , 24","3 , 24","10 , 24"], correct: 1 },
    { q: "الكيس المثقوب الذى ذكره حجى النبى فى سفره هو الذى يجمع امواله ويغلق عليها فلا يعطى للاخرين هذا ما قاله القديس", answers: ["البابا كليمنت","ايجانتوس","اكليمندس السكندرى"], correct: 2 },
    { q: "جاءت النبوة الثانية لحجى النبى فى اليوم الحادى والعشرين من الشهر السابع فيها يشجع العاملين على الاستمرار فالعمل دون الحزن على مجد الهيكل القديم", answers: ["صح","خطأ"], correct: 0 },
    { q: "منعت السماء المطر والارض غلتها . لماذا؟", answers: ["للتاديب","لتفريق الشعب","لم يكن موسم الحصاد"], correct: 0 },
    { q: "يدعو سفر حجى الى بناء بيت الرب قبل السبى", answers: ["صح","خطأ"], correct: 1 },
    { q: "اول رئيس كهنة لليهود بعد الرجوع من السبى هو يهوشع بن يهوصاداق", answers: ["صح","خطأ"], correct: 0 },
    { q: "كلمة مسطار المذكورة فى سفر حجى النبى تعنى.....", answers: ["الكاهن","مقياس","عصير العنب"], correct: 2 },
    { q: "قال ان اسم حجى ( عيد او فرح ) اشارة الى فرحة فى اتمام عمله النبوى وفرحة فى اعادة الحماس لبناء الهيكل", answers: ["العلامة اوريجانوس","العلامة جيروم","البابا ديمتريوس"], correct: 1 },
    { q: "الشعب وقف الشغل فبناء الهيكل مدة كم سنة", answers: ["10","15"," 20"], correct: 1 },
  ],
  malachi: [
    { q: "ايه معنى اسم ملاخى", answers: ["عيد","مبشر"," رسولى"], correct: 2 },
    { q: "تحدث سفر ملاخى عن محبة الله ليعقوب ورفضه لعيسو", answers: ["صح","خطأ",], correct: 0 },
    { q: "قام سفر ملاخى بتوبيخ الكهنة لانهم", answers: ["قدموا ذبائح بها عيوب","لم يطبقوا الشريعة","جميع ما سبق"], correct: 2 },
    { q: "يمثل سفر ملاخى مركز خاص عند اليهود وذلك لانه اخر اسفار الكتاب المقدس بالنسبة لهم", answers: ["صح","خطأ"], correct: 0 },
    { q: "بعد سفر ملاخى انتهى عصر النبوة وبدأ عصر .......", answers: ["الكتبة والكهنة","الملوك","القضاة"], correct: 0 },
    { q: "يعتبر سفر ملاخى هو اخر نبوات العهد القديم اللى اتسجل سنة.......ق.م", answers: ["550","445","90"], correct: 1 },
    { q: "تحدث سفر ملاخى عن نبى عظيم يأتى ليهيئ الطريق قبل مجئ الرب العظيم المخوف.فمن هو", answers: ["يوحنا","ايليا","أخنوخ"], correct: 1 },
    { q: "قال الله عنه فى سفر ملاخى ( جعلت جباله خرابا وميراثه لذئاب البرية )", answers: ["يعقوب","عيسو","ايليا"], correct: 1 },
    { q: "قال الله عنهم فى سفر ملاخى هم شعب يبنون وانا اهدم ويدعونهم تخوم الشر فهم........", answers: ["شعب سدوم","شعب أشور","شعب أدوم"], correct: 2 },
    { q: "(ان كنت ابا فاين كرامتى؟ وان كنت سيدا فاين هيبتى؟) من قائل هذه العبارة", answers: ["الله","حجى","ملاخى"], correct: 0 },
    { q: "اعتمد الله فى توجيه رسالته على يد ملاخى على نظام", answers: ["الاجابات","الامثال","الاسئلة"], correct: 2 },
    { q: "كانت رسالة ملاخى تعلن واجب الابن نحو ابيه من خلال ان .......", answers: ["يكرمه","يبغضه","يخدمه"], correct: 0 },
    { q: "الله لا يسر بالتقدمة بقدر سروره بقلب مقدمه", answers: ["صح","خطأ"], correct: 0 },
    { q: "ذكر الله فى سفر ملاخى انه يكره.......", answers: ["الخطية","التوبة","الانسان"], correct: 0 },
    { q: "ذكر الله المرأة ووفائها لزوجها منذ شبابه وانه شاهد على الاثنان فى الاصحاح.......", answers: ["الاول","الثانى","الثالث"], correct: 1 },
    { q: "من المقصود هنا : ( ها انا ارسل ملاكى فيهيئ الطريق امامى ) ", answers: ["ايليا","يوحنا المعمدان","ملاخى"], correct: 1 },
    { q: "اذكروا شريعة موسى عندى التى امرته بها فى.......", answers: ["اريحا","اشدود","حوريب"], correct: 2 },
    { q: "اخر كلمة فالعهد القديم هى لعن لان مسيح العهد الجديد سياتى ليزيل اللعنة", answers: ["صح","خطأ"], correct: 0 },
    { q: "كان الكهنة يحتقرون اسم الرب ...............", answers: ["بالحكم الظالم بين الشعب","بعدم تقديس السبت","تقديم ذبائح معيوبة "," بعدم تقديم ذبائح"], correct: 2 },
    { q: "كيف يوضح ملاخى (فى العهد القديم) إن الله لا يسمح بالطلاق لكل سبب", answers: ["قوله أن من طلق أمرأته وتزوج بغيرها فهو يغدر بها","بقوله أن الرب يكره الطلاق"," بقوله أن الرب خلق حواء واحده لآدم طالباً زرع الله","كل ما سبق"], correct: 3 },
  ]
};

// ===============================
// متغيرات اللعبة
// ===============================
let questions = [];
let currentQuestion = 0;
let score = 0;
let timeLeft = 20;
let timer;
const NEXT_DELAY = 1500;

const questionEl = document.getElementById("question");
const answerButtons = document.querySelectorAll(".answer");
const statusEl = document.getElementById("status");
const timerCircle = document.querySelector(".timer-circle");
const timerText = document.getElementById("timer-text");
const gameTitle = document.getElementById("game-title");

// صوت الساعة
const tickSound = new Audio("tick-short.wav");
const correctSound = new Audio("correct.wav");
const wrongSound = new Audio("wrong.wav");

// ===============================
// بدء اللعبة حسب السفر
// ===============================
function startGame(book) {
  document.getElementById("home").style.display = "none";
  document.getElementById("game").style.display = "block";

  questions = questionBank[book];
  currentQuestion = 0;
  score = 0;

  if (gameTitle) {
    const names = {
      zakaria: "أسئلة سفر زكريا",
      haggai: "أسئلة سفر حجّي",
      malachi: "أسئلة سفر ملاخي"
    };
    gameTitle.textContent = names[book] || "من سيربح البونبون";
  }

  loadQuestion();
}

// ===============================
// تحميل السؤال
// ===============================
function loadQuestion() {
  statusEl.textContent = "";

  if (currentQuestion >= questions.length) {
    endGame();
    return;
  }

  const q = questions[currentQuestion];
  questionEl.textContent = q.q;

  answerButtons.forEach((btn, i) => {
    if (i < q.answers.length) {
      btn.textContent = q.answers[i];
      btn.disabled = false;
      btn.style.backgroundColor = "#0f4c75";
      btn.style.display = "block";
    } else {
      btn.style.display = "none";
    }
  });

  timeLeft = 20;
  updateTimerUI();
  startTimer();
}

// ===============================
// التايمر
// ===============================
function startTimer() {
  clearInterval(timer);
  timerCircle.style.strokeDashoffset = 0;

  timer = setInterval(() => {
    timeLeft--;
    updateTimerUI();

    tickSound.currentTime = 0;
    tickSound.play().catch(() => {});

    if (timeLeft <= 0) {
      clearInterval(timer);
      tickSound.pause();
      blinkCorrectButton(true);
    }
  }, 1000);
}

function updateTimerUI() {
  timerText.textContent = timeLeft;
  const radius = 45;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference * (1 - timeLeft / 20);
  timerCircle.style.strokeDashoffset = offset;
}

// ===============================
// اختيار إجابة
// ===============================
function selectAnswer(index) {
  clearInterval(timer);
  tickSound.pause();
  tickSound.currentTime = 0;

  const q = questions[currentQuestion];
  const correctIndex = q.correct;
  const correct = index === correctIndex;

  answerButtons.forEach(btn => btn.disabled = true);

  if (correct) {
    score++;
    statusEl.textContent = "إجابة صحيحة!";

    correctSound.currentTime = 0;
    correctSound.play().catch(() => {});
    blinkButton(answerButtons[correctIndex], "green", 2, 200, delayedNext);
  } else {
    statusEl.innerHTML = `إجابة خاطئة!<br> الإجابة الصحيحة هي: ${q.answers[correctIndex]}`;
    wrongSound.currentTime = 0;
    wrongSound.play().catch(() => {});
    blinkButton(answerButtons[index], "red", 2, 200);
    blinkButton(answerButtons[correctIndex], "green", 2, 200, delayedNext);
  }
}

// ===============================
// وميض الأزرار
// ===============================
function blinkButton(btn, color, times, interval, callback) {
  let count = 0;
  const originalColor = "#0f4c75";
  const blinkInterval = setInterval(() => {
    btn.style.backgroundColor =
      btn.style.backgroundColor === color ? originalColor : color;
    count++;
    if (count >= times * 2) {
      clearInterval(blinkInterval);
      btn.style.backgroundColor = originalColor;
      if (callback) callback();
    }
  }, interval);
}

function blinkCorrectButton(fromTimer) {
  const correctIndex = questions[currentQuestion].correct;
  answerButtons.forEach(btn => btn.disabled = true);
  blinkButton(answerButtons[correctIndex], "green", 2, 200, delayedNext);

  if (fromTimer) statusEl.textContent = "انتهى الوقت!";
}

// ===============================
// التنقل
// ===============================
function delayedNext() {
  setTimeout(() => {
    currentQuestion++;
    loadQuestion();
  }, NEXT_DELAY);
}

// ===============================
// نهاية اللعبة
// ===============================
function endGame() {
  clearInterval(timer);
  tickSound.pause();
  tickSound.currentTime = 0;

  questionEl.textContent = "انتهت اللعبة!";
  statusEl.textContent = `⭐ نتيجتك النهائية: ${score} من ${questions.length}`;
  answerButtons.forEach(btn => btn.style.display = "none");

  const timerContainer = document.querySelector(".timer-container");
  if (timerContainer) timerContainer.style.display = "none";
}


function goHome() {
  clearInterval(timer);  // توقف العد
  tickSound.pause();
  tickSound.currentTime = 0;

  // إعادة عرض الصفحة الرئيسية وإخفاء صفحة اللعبة
  document.getElementById("home").style.display = "block";
  document.getElementById("game").style.display = "none";

  // إعادة تعيين المتغيرات الأساسية للعبة
  currentQuestion = 0;
  score = 0;
  questions = [];
  statusEl.textContent = "";
  questionEl.textContent = "";
  answerButtons.forEach(btn => btn.style.display = "block");
  const timerContainer = document.querySelector(".timer-container");
  if (timerContainer) timerContainer.style.display = "block";
}



